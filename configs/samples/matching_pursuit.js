
/***
This is an example of using matching pursuit to build sparse general
feature dictionaries from data.
https://en.wikipedia.org/wiki/Matching_pursuit
***/

// Weight initialisers to speed up learning for mnist (essentially centring)
var initWeights = new Float64Array([1.5e-323,1.5e-323,1.5e-323,1.5e-323,4.882721917077202e-134,1.74007127505392e-132,3.529485401531557e-132,8.920348989508097e-131,9.41609979190385e-31,6.25893692050079e-30,1.2185540907169673e-30,3.522694374168034e-31,8.748024362517285e-30,1.4912739517311402e-29,9.752331064702494e-103,9.295628779830642e-128,1.0287652404555714e-128,1.1563821777751471e-169,3.932103698434251e-211,2.71813839838176e-217,4.316429436804756e-217,1.7803238275838085e-217,1.5e-323,1.5e-323,1.5e-323,1.5e-323,1.5e-323,1.5e-323,1.5e-323,1.5e-323,1.5e-323,1.5e-323,1.769986694940492e-133,6.9190391499015214e-46,3.3289716664620635e-45,2.2692276309545033e-14,2.3517449993528455e-13,2.5270944071993303e-13,2.2436177062425867e-13,5.473285655167271e-13,5.694435552640004e-13,9.9642190512534e-19,3.729101294164589e-13,2.9459696305662167e-12,2.986964124606966e-8,1.7594524783400198e-7,2.1562539557092796e-8,9.357143852920653e-9,3.1770733889631946e-8,5.514748142272311e-8,1.2353035838689973e-8,3.7685327630435767e-79,6.361780178917399e-89,1.5e-323,1.5e-323,1.5e-323,1.5e-323,1.5e-323,1.5e-323,1.5e-323,3.149797920658715e-37,6.772065531653169e-36,4.785104531720639e-10,1.3309627066676538e-8,2.4380546699453728e-8,1.3493933532548765e-8,3.1044204480693903e-9,6.299815550997453e-10,6.101427354426255e-10,0.000020833061465277585,0.0001810816998906213,0.0004093688665313237,0.00040661127045192125,0.00009178273533775195,0.00003697517704255131,0.00014774609928594164,0.00008520620269482674,1.2010056237703432e-7,3.5864080705453553e-7,0.0000016105002279052713,0.0000013668951514153986,8.120169216329109e-8,1.5e-323,1.5e-323,1.5e-323,1.5e-323,1.3009929793132295e-196,5.7979034947654955e-196,1.0235486246203325e-47,3.0360828866624192e-12,3.361693108372975e-9,2.4423299933252205e-8,9.443026256706862e-8,0.000024264785741678207,0.0003571384710149519,0.0007515852924855089,0.004228050769591624,0.007277864668568443,0.005155741055089926,0.00461603170961415,0.0028128518452068367,0.005026251378549576,0.007796400826262611,0.010088254094677092,0.008705730755798259,0.005604504042472569,0.0034208024292459124,0.0000018208677718541513,0.0000017364408761147895,8.932186137962013e-7,2.722803876889982e-69,1.5e-323,1.5e-323,2.064619293257942e-196,0.0013605372817894078,4.563912343601748e-50,4.4902254033991455e-40,7.666110212038307e-11,6.843211518119952e-8,0.00009791925618559858,0.0023715353041855974,0.01422741926181487,0.014906124509091258,0.015621931228179065,0.02420987645772793,0.02230732735729953,0.00787312426437258,0.008220273749961031,0.009602358824322133,0.012012588894185003,0.01536891976007204,0.017340879855959297,0.01435930250407709,0.008447524134615698,0.005460686757237889,0.002424861744178044,0.0010243074992658699,0.00010368945058461076,0.00001682560736521445,9.487677560958698e-97,1.5e-323,3.306119396130669e-55,0.001486125338569969,3.0866166664049944e-48,9.799676834998208e-21,0.0000023157340890900765,0.0006656990800345301,0.0010824192436380232,0.00816963038551833,0.019465595052680945,0.022092193193003092,0.03365792193253931,0.039587437462755684,0.039752641168696035,0.034213419022261646,0.03753968434335228,0.04050493065620375,0.051263159013652304,0.054392131877823977,0.040300257142799584,0.03160445759043223,0.02146408000664945,0.010008786008865166,0.003980823855111989,0.0020997235803467146,0.0006800982706991978,0.00008272157598324397,0.000002548994233351552,1.5e-323,2.1765286024526806e-55,5.579684089873483e-12,2.836709527584037e-10,0.0005895536019355325,0.0009941244063889272,0.0014588947396030796,0.001975632164079573,0.012114876735995806,0.02507436066257297,0.035917178599503996,0.045769379342609495,0.050387421307735124,0.05530843572988005,0.06003178367855114,0.06559303044340555,0.07414510123886997,0.07716414304643927,0.06917488265904172,0.06467924994839665,0.054513502636056636,0.035839132258147256,0.017807790035114852,0.0051221350329234295,0.00269849784404983,0.0016476360464315757,0.00011334055730049272,0.000002704000639434416,8.641891016392522e-131,2.6510341992763993e-11,3.5648609734128215e-11,4.5315993474935926e-11,0.000786476259319873,0.0010604922863821369,0.004563678092390147,0.006562876568044259,0.01305951693839298,0.029500828974403613,0.0483347756097575,0.05409625656911017,0.0637163299666289,0.06735108147044788,0.07365463072549781,0.08257154954268538,0.08519483153875708,0.08642947920708104,0.08450990905971073,0.07201265539169506,0.06317622703532796,0.04623308796153172,0.022022169329204925,0.005778203137500368,0.0024879191051954833,0.0012350790379012592,0.0000794169783136244,1.03337604057128e-7,4.129127856438861e-13,3.02390233171918e-11,4.409394699828914e-11,1.9783201080743032e-10,0.00000950754479745391,0.0030068137115594248,0.008434285507232414,0.009656623777389671,0.012917226881381734,0.025564447997775144,0.03729781270087291,0.054462395067368455,0.06428610413393221,0.0734963849361362,0.07882166146818746,0.08243758874031172,0.07952864770584195,0.08186279792438678,0.08036493946353898,0.07224883387166407,0.06450800502945236,0.04797325526004242,0.03010621874981326,0.013579618876640826,0.005415985088655189,0.0020278843711683254,0.00002353416920661644,4.297643259204401e-18,2.103186036579825e-12,2.2154095469416607e-11,3.7446082005822153e-11,2.187299578431211e-10,0.0000344297226177184,0.004654167069463264,0.0120365113021455,0.014221710587904252,0.02352280960029446,0.035460408846708286,0.047677689416755695,0.06193126915414085,0.07746131307946316,0.07671204321878787,0.07223220524821271,0.07384083010926366,0.07878399827079613,0.07773866455394882,0.07216092745837946,0.06619005399026223,0.06130604590872911,0.043934181301146895,0.0319608818721712,0.01584125863468259,0.006258939305195933,0.00409329680878363,0.0002983947598300521,8.500890498580677e-26,1.6081302412770944e-12,3.3242527549412568e-12,5.242058638908854e-12,0.00005254228946746183,0.0006898886456604285,0.0030195595112848025,0.007540368822736757,0.015904546682901255,0.028210880862385563,0.046455400133051904,0.06002388122449372,0.07027117189675232,0.07722698610134734,0.07071064810057637,0.07175999837342227,0.06994141625956253,0.06619964623137713,0.05893860706961578,0.06072453994973041,0.06181531045563016,0.05540284388001723,0.04178517207382573,0.030769020485663143,0.013382773312247118,0.007629057561985448,0.002723993099543129,0.0002286412607550724,3.5208465940714626e-13,1.2196857360185804e-13,1.7407397232346665e-12,0.000025036665779765478,0.0003227416901560125,0.0009204646405827175,0.0021849238317602953,0.006663947856899944,0.018742328862073925,0.03554972260212987,0.05432304993208929,0.06415850128065421,0.07527849139218903,0.06608666413142146,0.06409885889076297,0.06777051832707762,0.06210304998037289,0.05497008034487996,0.05787845638446636,0.06444863880467072,0.061457025863132037,0.055145257179408685,0.04229305837300143,0.028150550959815047,0.016649898221703447,0.013556837386137197,0.005737251923685891,0.00038973068110589263,0.000022214701404599973,2.8699105052258375e-59,2.8482005543304194e-13,0.00009509774748033712,0.00037025748958857804,0.000613146618705915,0.005044513399594055,0.014041474848540566,0.025063364435278342,0.04673384406092783,0.05741122090270827,0.07247787110018038,0.07510444606221325,0.06417803368278377,0.06786175124644553,0.0665541174642862,0.06170569350251629,0.05920130634680568,0.0687252353250207,0.06628074676045227,0.06650968218234378,0.059314572451648645,0.04703020508038487,0.027899879669765065,0.016909220957257675,0.011876205916243747,0.006855698326548702,0.001067417901921211,0.0006681154043416506,4.0358116479738217e-60,7.549185245139193e-49,0.00012540949751124343,0.0001501119694255582,0.002679237719748413,0.012003965716881207,0.021308735770640738,0.036037293551940505,0.0519564822392029,0.06455071233300524,0.08027273733314394,0.07772800132457969,0.06887984496841609,0.07497370873818994,0.07605245035821499,0.07351238692589948,0.07960368590391041,0.07532498155595271,0.07134699909998046,0.0663317223658537,0.06284861353856021,0.04134933564922299,0.023562033318103234,0.012147873156851776,0.0032844508405952743,0.004229001340485381,0.0008269392064349807,0.0005644131587981339,2.5478994508670082e-188,4.389693834942778e-179,0.0000883646938657525,0.0022484701437264117,0.009203496248100898,0.01727867606252224,0.03039467440384197,0.03794278522719574,0.04553786157954268,0.050345699970444115,0.06211944650379286,0.060296713279334994,0.06451767914414984,0.06929857301283569,0.07582000106350874,0.07628426782040419,0.07498861464040399,0.0753813433218007,0.07656057726948177,0.07258283347530683,0.053181689438949103,0.028909473379765526,0.020098995082268176,0.010090408712129064,0.0015142196846870777,0.00029159906881683263,0.0000471987279402658,0.000005329703076811059,1.5e-323,2.8346592582614397e-140,0.00001865476988629772,0.003976922052776622,0.013230552343686384,0.022991082997417197,0.035879684254161874,0.04594213242491674,0.05436825604823573,0.05278267705996257,0.06057612798312991,0.061903670628697255,0.07024320148417618,0.07582767221939064,0.07721837751839618,0.0731687759654123,0.07034291411463144,0.07730747991581666,0.08457450173353097,0.08303868465648911,0.048496555618141785,0.03185125829467926,0.019249804765611153,0.004790701514197698,0.0016846764887232365,0.0006738718930206853,0.0000028536801124798257,5.659861674489612e-7,2.8344714676547807e-243,5.071086244633708e-65,1.3458886940838721e-37,0.0058209800407864895,0.016258837323576608,0.026281746565795128,0.039734012308889066,0.05296695123881769,0.06024630077808782,0.057668952902808095,0.057815182206674726,0.06210616153326298,0.066876927061871,0.07188618853140732,0.06899175894876916,0.06201220082402838,0.06818597821040323,0.08038811502065958,0.08760477148128065,0.07030309928204376,0.03968795230872673,0.024166961260846154,0.012342724588811187,0.0026178394295610897,0.0021279009961730185,0.0011500554479408622,0.000015177656282446687,2.6757937437871467e-44,1.6896031086292686e-194,1.3487057161047608e-63,0.0000023017712441641304,0.005043346255024152,0.012178449310557478,0.02646440583963353,0.042538566713149165,0.06346470569800841,0.06567243314371042,0.06454900492247982,0.056626184493349656,0.060691339267928454,0.06414633575584688,0.06406843588527623,0.0670636870030211,0.06641964323190024,0.06925168164266873,0.08096062863739631,0.08449831273883032,0.06393283985293201,0.03658655494344591,0.016980527016550603,0.006215962890470557,0.003584282957422894,0.0020963224997705096,0.0014113413227878264,1.054738944004728e-14,9.45865903082874e-44,2.5585418502100237e-193,4.862368334902875e-63,0.00002000770389353335,0.0012597252649841338,0.0070583149154530185,0.022909862748535997,0.045202748984282386,0.06293765882774567,0.07110719015830164,0.06650448216854175,0.06711579875909315,0.0618447384223077,0.06115863258796634,0.05976376464692114,0.0659197718555492,0.06620530221807605,0.06467817121502577,0.07581085961302286,0.07076882401499693,0.05366613356820739,0.02336534221025413,0.010302388718872242,0.00538574472172284,0.004178927808452942,0.0021271351794220805,0.0009785189184226969,3.546140835960037e-10,5.148866810841971e-44,1.047906866254969e-189,3.209548217767175e-41,0.00010616326351774561,0.0006118729814115392,0.005843089832833145,0.022820473865344654,0.042373602482149615,0.06551994850235064,0.06979756023978113,0.06561621092963926,0.07000310203523764,0.06708009331669786,0.060683745550724345,0.06540973490263625,0.07106361308256216,0.07421815311721977,0.06935540293948053,0.06261834421339256,0.05531389117368642,0.04045047705331775,0.016660169921201833,0.012257932131087342,0.004972085758003077,0.003398402404992241,0.001943683263424158,0.00012650553007654576,0.0000030513554444494694,5.190866665668389e-120,1.491210860012273e-188,4.953006508916704e-41,0.0002649052509685605,0.002398144209109711,0.005800315652145454,0.014870576539808781,0.03618798034432823,0.055931960749766405,0.07035069845372921,0.06943218772397484,0.07086311228447707,0.06941362959293546,0.07180254974561812,0.07771603741599863,0.08193624187635087,0.07683648514703686,0.06695536328123464,0.052256156535706914,0.03524685500830015,0.021245458790199765,0.009944224123435057,0.011847556325780464,0.006141252241348452,0.001750901229017277,0.0004037464357441241,0.0000015521038221829945,7.477581394814609e-15,9.688317699803469e-125,3.930211409729104e-248,3.3073687156107456e-9,0.000051481877267493936,0.0023672794378839235,0.00466019015947712,0.011450759585290224,0.0245442053102581,0.04488713691706529,0.0655698543847662,0.07260685976706514,0.07463259741446915,0.07966314975027411,0.08114834968237065,0.08054137353683591,0.08485931675700704,0.07876093178837963,0.055215668181634675,0.03867853349243974,0.02409551741463265,0.008762960927466062,0.004217107918281923,0.00814667459507338,0.0041555565056036565,0.0005047497092118242,1.5306630997970802e-7,4.046776128993122e-11,5.047367441499867e-14,8.563222741116664e-125,4.700262375314093e-21,5.000116483444491e-9,0.00008921944156478391,0.002074063336544437,0.0036620967025744926,0.005912756306453715,0.011284935689724624,0.03190357046125028,0.046734839280147294,0.06413452203797215,0.0740742348621848,0.08089007215839522,0.07497533684402496,0.07072489501598943,0.07147013992516833,0.06104609156097398,0.04040343207336554,0.026240036277115658,0.011608415565929437,0.005333196669026766,0.0021802559285828077,0.0031950813460415147,0.001015609452007082,0.0002478724602997373,0.000001284090372578134,4.353876223497583e-12,8.100713177715821e-15,5.000422038608223e-126,4.553379176085537e-21,5.651173317226123e-9,0.0005061312480277537,0.0026520395233057405,0.0027235784028785434,0.004195025456824374,0.007488830710231008,0.015943021319833238,0.025200218437532094,0.036211269555409785,0.04722113458848182,0.05495412827462933,0.056577796917189865,0.047703444498108004,0.04914901764424152,0.04181917041038085,0.01672096892803698,0.006517021041896977,0.003864264089053629,0.002625114333015629,0.00048774735414570036,0.0003860892286972656,0.00004664434812888592,0.00004329935675217964,0.000005503357131982741,1.0717087641482795e-14,3.601639641819522e-25,6.233607072379924e-26,1.5e-323,5.651173317224664e-9,0.00006614806998548609,0.001031912549843736,0.0014889801171329637,0.002019295980566473,0.003837571108204385,0.00813888930674242,0.012105814366762824,0.016678509443710902,0.018150487090159505,0.018486139954407392,0.019938415932931473,0.018576350889337852,0.025480051805886837,0.014583601695922913,0.001909818947270329,0.0005565295930442856,0.0001494621735394881,0.00014563887206277588,0.000044142529621892856,0.000028546153253886856,0.000004173652689833518,0.000024939854690212524,0.000004380221273113479,1.8062346515774197e-46,1.3872930510406174e-48,1.5e-323,1.5e-323,4.166763736202514e-10,3.333410988962011e-9,6.600211659660087e-9,0.000022015853906501242,0.00013937249096028043,0.000982551564790256,0.0021737718256408744,0.0020178350756715913,0.0024266791912664677,0.004528878805089808,0.006255582810210623,0.010270161851058167,0.010179383590309198,0.005861972400546265,0.0005545703280773324,0.0002948405826533919,0.00014745095236122144,0.00009641509217882888,0.00005752882422570954,0.000033757458100586065,0.0003216487478544661,0.0000787260411709963,0.00000141514811192369,1.1231334221616572e-7,6.956133648689353e-61,3.214905013124953e-61,1.5e-323,1.5e-323,1.5e-323,3.450492646536538e-66,6.681906394880296e-66,0.000023810776716986793,0.00004678542835299495,0.00013646499149412572,0.000215941035852321,0.0001766370266471836,0.0016377207541904333,0.004364108453435852,0.004616416009294647,0.006593891689728088,0.006450281182792133,0.0012972897124028944,0.00017478237418926574,0.00014342807998918343,0.000008275221773738357,0.000012277607361767052,0.000023350830420230964,0.000026464030958529973,0.0015964893691157254,0.0003923766195415491,6.0095930463437394e-27,8.75890611537672e-28,2.8540483279782876e-61,3.4117359322958746e-61,1.5e-323,1.5e-323,1.5e-323,1.5e-323,1.388548933634002e-117,0.0000016504091892079166,0.00002047628164711543,0.00008018430887106839,0.00015708520044699026,0.00013725851024010136,0.0007409587050232679,0.004113216226269275,0.004313643418161036,0.003585525033599506,0.000015774989588265013,0.00010565472266488949,0.0001238415783335213,0.00001573544727513579,3.0121433007370355e-11,1.5089175053398194e-11,8.668491622556344e-12,3.547308584093637e-12,6.0396096996715385e-28,1.2582539958190344e-64,3.356601300530404e-132,1.5e-323,1.5e-323,1.5e-323,1.5e-323]);
initWeights.normalise();

module.exports = {
	layers: [
		{ type: 'mnist', id: 'input', input: true, options: {
			translateRange: 2
		}},
		{ type: 'matching_pursuit', id: 'map', options: {
			initWeights,
			totalFeatures: 800,
			sparseThreshold: 1.4,
			log: true
		}},
		{ type: 'reconstruction', id: 'recon', options: {
			x: 28, y: 28,
			learningLayerId: 'input'
		}}
	],
	renderers: [
		{ type: 'tensor', title: 'Input', data: ['input'], options: { zoom: 1 } },
		{ type: 'tensor', title: 'Reconstruction', data: ['recon'], options: { zoom: 1 } },
		{ type: 'tensor', title: 'Full Reconstruction', data: ['map', 'getFullReconstructions'], options: { zoom: 1 } },
		{ type: 'tensor', title: 'Dictionary', data: ['map', 'getNormWeights'], options: { zoom: 1 } }
	]
};